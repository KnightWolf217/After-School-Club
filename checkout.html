<!DOCTYPE html>
<html>

<head>
    <title>Checkout</title>
    <script src="https://unpkg.com/vue"></script>
</head>

<body>
    <!-- app div -->
    <div id="app">
        <button v-on:click=home>Back to Lessons</button>
        <h1>Shopping Cart - </h1>
        <h1></h1>
        <div v-for="array in cart">
            <div style="border:solid; height:220px; width:300px;">
                <div style="float:left;">
                    <img style="height: 120px; width: 120px; object-fit: contain;" v-bind:src="array.image">
                </div>
                <div style="float:left;">
                    <h2 v-text="array.title"></h2>
                    <p v-text="array.location"></p>
                    <p style="display:inline">Price: Â£</p>
                    <span v-text="array.price">
                </span>
                    <br><br>
                    <div>
                        <button v-bind:id="cart.indexOf(array)" v-on:click="remove($event)">Remove</button>
                    </div>
                </div>
            </div>
            <h1></h1>
        </div>
        <h1></h1>
        Please Enter your Details for Checkout -
        <p></p>
        Name: <input v-model="user.name" v-on:input="checkDetails" id="name" type="text"></input> &nbsp; &nbsp; Phone: <input v-model="user.phone" v-on:input="checkDetails" id="phone"></input>
        <h2></h2>
        <button id="checkout" v-on:click="order">Checkout</button>
        <div id="confirm"></div>

    </div>

    <script>
        document.getElementById("checkout").style.display = "none"; //disabling checkout button until the user enters a valid name and phone number
        let app = new Vue({ //vue instance
            el: '#app',
            data: {
                user: {
                    name: "",
                    phone: ""
                },
                sitename: "After School Club",
                cart: [],
            },
            methods: {
                AddLessons() { //adding lessons from local storage to cart array 
                    var keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        var x = localStorage.getItem(key)
                        var y = JSON.parse(x);
                        this.cart.push(y);
                    })
                },
                home() {
                    window.location.href = "index.html"; //button to redirect back to lessons page
                },
                remove(id) { //removing the selected lesson from cart
                    id = event.currentTarget.id;
                    this.cart.splice(id, 1);
                },
                checkDetails() {
                    let name = this.user.name;
                    let phone = this.user.phone;
                    if ((phone.length == 10) & (name.length != 0) & (!/[^a-zA-Z]/.test(name)) & !isNaN(phone)) { //check if name is not empty and only letters, phone is 10 digits and only numbers
                        document.getElementById("checkout").style.display = "block"; //display the checkout button if name and phone are valid
                        document.getElementById("confirm").innerHTML = ""; //removing error message
                        let bottom = document.getElementById("confirm");
                        bottom.scrollIntoView();
                    } else {
                        document.getElementById("confirm").innerHTML = "<p>Please enter a valid name and 10 digit phone number!</p>"; //display error message
                        document.getElementById("checkout").style.display = "none"; //removing checkout button if name and phone are invalid
                        let bottom = document.getElementById("confirm");
                        bottom.scrollIntoView();
                    }
                },
                order() {
                    document.getElementById("confirm").innerHTML = "<h2>Order Complete!</h2>" +
                        "<p></p>" +
                        "<p>Name: " + this.user.name + "</p>" + //display user name
                        "<p>Phone: " + this.user.phone + "</p>" + //display user phone
                        "<h2></h2>" +
                        "<p>Lessons Ordered - </p>" + "<span id='lessons'></span>";
                    for (i = 0; i < this.cart.length; i++) { //display lessons that were ordered
                        items = "<li>" + this.cart[i].title + "</li>"
                        document.getElementById('lessons').innerHTML += items;
                    };
                    let bottom = document.getElementById("confirm");
                    bottom.scrollIntoView();
                    alert("Order Submitted! Please click ok to see order details");
                }
            },
            beforeMount() { // add lessons from local storage to cart when the page loads
                this.AddLessons()
            },
        })
    </script>

</body>

</html>